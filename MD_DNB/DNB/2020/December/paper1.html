<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF Flipbook Viewer</title>
    <!-- External Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/turn.js/4.1.0/turn.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.min.js"></script>
    
    <!-- Inline Styles -->
    <style>
        :root {
            --primary-color: #007bff;
            --secondary-color: #6c757d;
            --background-color: #f8f9fa;
            --surface-color: #ffffff;
            --text-color: #333;
            --shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: var(--background-color);
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }

        /* --- Viewer Screen --- */
        #viewer-wrapper {
            display: flex; /* Changed from none to be visible by default */
            flex-direction: column;
            height: 100vh;
            width: 100vw;
        }

        #flipbook-container {
            flex-grow: 1;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #flipbook {
            width: 90vw;
            height: calc(100vh - 80px); /* Full height minus toolbar */
            transition: transform 0.5s;
        }

        #flipbook .page {
            background-color: white;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center center;
        }

        #flipbook .shadow,
        #flipbook .gradient {
            border-radius: 6px;
        }

        /* --- Toolbar --- */
        #toolbar {
            height: 60px;
            width: 100%;
            background-color: var(--surface-color);
            box-shadow: 0 -4px 15px rgba(0,0,0,0.08);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 20px;
            box-sizing: border-box;
            gap: 15px;
            z-index: 1000;
        }

        .toolbar-button {
            background: none;
            border: none;
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s;
        }
        
        .toolbar-button:hover {
            background-color: #e9ecef;
        }

        .toolbar-button svg {
            width: 24px;
            height: 24px;
            fill: #555;
        }
        
        .toolbar-button:disabled svg {
            fill: #bbb;
        }

        #page-number-input {
            width: 40px;
            text-align: center;
            border: 1px solid #ccc;
            border-radius: 4px;
            padding: 5px;
            font-size: 14px;
        }

        #page-indicator {
            font-size: 14px;
            color: var(--secondary-color);
            min-width: 50px;
            text-align: left;
        }

        /* --- Loader --- */
        #loader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            color: var(--text-color);
            z-index: 2000;
        }

    </style>
</head>
<body>

    <!-- The viewer is now the main element, upload prompt is removed -->
    <div id="viewer-wrapper">
        <div id="flipbook-container">
            <div id="flipbook"></div>
        </div>
        <div id="toolbar">
            <button id="prev-page-btn" class="toolbar-button" title="Previous Page">
                <svg viewBox="0 0 24 24"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"></path></svg>
            </button>
            <input type="number" id="page-number-input" min="1">
            <span id="page-indicator">/ 1</span>
            <button id="next-page-btn" class="toolbar-button" title="Next Page">
                <svg viewBox="0 0 24 24"><path d="M8.59 16.59L10 18l6-6-6-6-1.41 1.41L13.17 12z"></path></svg>
            </button>
            <div style="width: 30px;"></div> <!-- Spacer -->
            <button id="zoom-in-btn" class="toolbar-button" title="Zoom In">
                <svg viewBox="0 0 24 24"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"></path></svg>
            </button>
            <button id="zoom-out-btn" class="toolbar-button" title="Zoom Out">
                <svg viewBox="0 0 24 24"><path d="M19 13H5v-2h14v2z"></path></svg>
            </button>
             <div style="width: 30px;"></div> <!-- Spacer -->
            <button id="toggle-fullscreen-btn" class="toolbar-button" title="Toggle Fullscreen">
                <svg id="fullscreen-icon" viewBox="0 0 24 24"><path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"></path></svg>
                <svg id="exit-fullscreen-icon" style="display:none;" viewBox="0 0 24 24"><path d="M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z"></path></svg>
            </button>
        </div>
    </div>

    <!-- Global Loader -->
    <div id="loader" style="display: none;">Loading...</div>

<script>
// Configure PDF.js worker
if (typeof pdfjsLib !== 'undefined') {
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.worker.min.js';
}

// DOM Elements
const viewerWrapper = document.getElementById('viewer-wrapper');
const flipbookEl = document.getElementById('flipbook');
const loader = document.getElementById('loader');

// Toolbar Elements
const prevPageBtn = document.getElementById('prev-page-btn');
const nextPageBtn = document.getElementById('next-page-btn');
const pageNumberInput = document.getElementById('page-number-input');
const pageIndicator = document.getElementById('page-indicator');
const zoomInBtn = document.getElementById('zoom-in-btn');
const zoomOutBtn = document.getElementById('zoom-out-btn');
const toggleFullscreenBtn = document.getElementById('toggle-fullscreen-btn');

// PDF State
const pdfUrl = "/MD_DNB/DNB/2020/December/DNB DEC 2020 PAPER 1.pdf";
let pdfDoc = null;
let zoomLevel = 1;

// --- AUTO-LOAD PDF ON PAGE LOAD ---
document.addEventListener('DOMContentLoaded', () => {
    loadPdfFromUrl(pdfUrl);
});

async function loadPdfFromUrl(url) {
    try {
        loader.style.display = 'flex';
        
        const response = await fetch(url);
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        const pdfData = await response.arrayBuffer();
        const typedarray = new Uint8Array(pdfData);
        await renderPdfPages(typedarray);

    } catch (error) {
        console.error('Failed to load PDF from URL:', error);
        alert(`Could not load the PDF from the specified URL.\nError: ${error.message}`);
        loader.style.display = 'none';
    }
}


// --- PDF RENDERING ---
async function renderPdfPages(pdfData) {
    try {
        pdfDoc = await pdfjsLib.getDocument(pdfData).promise;
        const numPages = pdfDoc.numPages;
        
        pageIndicator.textContent = `/ ${numPages}`;
        pageNumberInput.max = numPages;
        flipbookEl.innerHTML = '';

        // Render all pages
        for (let i = 1; i <= numPages; i++) {
            const page = await pdfDoc.getPage(i);
            const viewport = page.getViewport({ scale: 1.5 }); // High-res for quality
            
            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d');
            canvas.height = viewport.height;
            canvas.width = viewport.width;

            const pageWrapper = document.createElement('div');
            pageWrapper.appendChild(canvas);
            flipbookEl.appendChild(pageWrapper);

            await page.render({ canvasContext: context, viewport: viewport }).promise;
        }

        initializeFlipbook(numPages);
    } catch (error) {
        console.error('Error rendering PDF pages:', error);
        alert('Could not render the PDF file. It might be corrupted or protected.');
    } finally {
        loader.style.display = 'none';
    }
}

// --- FLIPBOOK INITIALIZATION & CONTROLS ---
function initializeFlipbook(numPages) {
    const flipbook = $(flipbookEl);

    flipbook.turn({
        width: '90vw',
        height: 'calc(100vh - 80px)',
        autoCenter: true,
        display: 'double',
        elevation: 50,
        gradients: true,
        when: {
            turned: function(event, page) {
                updateControls(page, numPages);
            }
        }
    });

    // Initial control state
    updateControls(1, numPages);

    // Toolbar event listeners
    prevPageBtn.addEventListener('click', () => flipbook.turn('previous'));
    nextPageBtn.addEventListener('click', () => flipbook.turn('next'));

    pageNumberInput.addEventListener('change', (e) => {
        const page = parseInt(e.target.value, 10);
        if (page > 0 && page <= numPages) {
            flipbook.turn('page', page);
        }
    });

    zoomInBtn.addEventListener('click', () => {
        zoomLevel += 0.1;
        flipbook.turn('zoom', zoomLevel);
    });
    
    zoomOutBtn.addEventListener('click', () => {
        zoomLevel -= 0.1;
        flipbook.turn('zoom', zoomLevel);
    });

    toggleFullscreenBtn.addEventListener('click', toggleFullscreen);
    document.addEventListener('fullscreenchange', updateFullscreenIcon);
}

function updateControls(currentPage, totalPages) {
    pageNumberInput.value = currentPage;
    prevPageBtn.disabled = currentPage === 1;
    nextPageBtn.disabled = currentPage === totalPages;
}

// --- FULLSCREEN LOGIC ---
function toggleFullscreen() {
    if (!document.fullscreenElement) {
        document.documentElement.requestFullscreen();
    } else {
        if (document.exitFullscreen) {
            document.exitFullscreen();
        }
    }
}

function updateFullscreenIcon() {
    const fsIcon = document.getElementById('fullscreen-icon');
    const exitFsIcon = document.getElementById('exit-fullscreen-icon');
    if (document.fullscreenElement) {
        fsIcon.style.display = 'none';
        exitFsIcon.style.display = 'block';
    } else {
        fsIcon.style.display = 'block';
        exitFsIcon.style.display = 'none';
    }
}

</script>
</body>
</html>
